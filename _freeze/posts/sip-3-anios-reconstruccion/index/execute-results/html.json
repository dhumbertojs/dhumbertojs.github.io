{
  "hash": "91af2158669e3b394f7134f35258f84c",
  "result": {
    "markdown": "---\ntitle: \"A 3 años del sismo en la CDMX\"\ndescription: \"Breve análisis de las solicitudes de información pública relacionadas con el sismo del 19S de 2017\"\nauthor: \"David Humberto Jiménez S.\"\ndate: \"2020-09-24\"\ndate-modified: \"2023-11-24\"\ncategories: [code, text-analysis, visualization, public information, spanish]\nimage: \"sismo.png\"\n---\n\n\n# Holi...\n\n¡Bienvenidas! Dejé esto abandonado por algún tiempo, la pandemia me dejo todo revuelto y apenas he retomado muchas de las actividades que mantenían mi cordura. Ahora, quiero escribir sobre algo que hice en el trabajo, y un par de trucos para empezar a usar **purrr::map()** y facilitarse la vida con tareas repetitivas.\n\nActualmente, trabajo en el Instituto de Transparencia, Acceso a la Información Pública, Protección de Datos Personales y Rendición de Cuentas de la Ciudad de México (**INFO CDMX**). Una de mis tareas es procesar datos estadísticos de las solicitudes, y a principios de este mes (septiembre) se realizó el [*2° Coloquio Internacional por una reconstrucción abierta en la CDMX*](https://infocdmx.org.mx/reconstruccionabiertaCDMX/programa/) en donde se abrieron datos sobre solicitudes referentes al sismo del 19 de septiembre de 2017.\n\nEntonces, vamos a utilizar las bases de datos disponibles. Van a la sección de [multimedia](https://infocdmx.org.mx/reconstruccionabiertaCDMX/multimedia/) y van a descargar el archivo *zip* que dice repositorio y lo van a descomprimir. Como es un archivo *zip*, no deberían tener ningún problema, si no pueden descargar [winrar](https://www.winrar.es/descargas/103/descargar-winrar-para-windows-x64-en-espanol) (esto no es un comercial, pero me parece el más útil).\n\nEn el archivo van a encontrar: \n\n1. Un archivo con todas las solicitudes.\n2. Tres archivos con las solicitudes por año. Es decir, un archivo con todas las solicitudes de 2017, 2018 y 2019.\n3. Tres carpetas con los archivos individuales por año. En este caso, cada carpeta tiene los archivos de las dependencias e instituciones que recibieron solicitudes. Por ejemplo, *Delegación Benito Juárez-2017.xlsx*.\n\nEl origen de estos datos es de las solicitudes de información realizadas durante el periodo registrado, así como la integración de la información por los sujetos obligados (nombre para las instituciones que reciben y ejercen recursos públicos de manera sistemática, desde secretarías hasta sindicatos). Entonces, además de poder observar los textos de las solicitudes, podemos acceder a algunos datos socio demográficos. Y ahora sí, con el código :D\n\n## Libraries o paquetes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(purrr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'purrr' was built under R version 4.2.3\n```\n:::\n\n```{.r .cell-code}\nlibrary(scales)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'scales'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:purrr':\n\n    discard\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(stringr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'stringr' was built under R version 4.2.3\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(lubridate)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'lubridate'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n```\n:::\n:::\n\n\nComo siempre, lo primero es \"llamar\" los paquetes. Y luego, definir los \"directorios\", es decir las carpetas donde tenemos los archivos que vamos a trabajar. Por eso es muy importante que tengan orden en sus carpetas, sino puede ser muy complicado trabajar.\n\nIntenté hacerlo con *setwd()*, que es la manera base, pero la verdad era demasiado escribir y copiar. Si quieren intentarlo tendrían que poner algo así: **setwd(\"/Users/equipo/carpeta/Bases de SIP sobre reconstrucción en la CDMX\")**.\n\nPero yo, como siempre, haré que mis directorios sean objetos de r:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninput <- \"D:/dhumb/Documents/projects/data_blog/Bases de SIP sobre reconstrucción en la CDMX\"\nlist.files(input)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2017\"                                                                \n[2] \"2017 final.xlsx\"                                                     \n[3] \"2018\"                                                                \n[4] \"2018 final.xlsx\"                                                     \n[5] \"2019\"                                                                \n[6] \"2019 final.xlsx\"                                                     \n[7] \"2020.09.03_Nota-Criterios de_Bases SIP-Reconstrucción 2017-2019.docx\"\n[8] \"Bases de SIP sobre reconstrucción en la CDMX.rar\"                    \n[9] \"Reconstruccion consolidada.xlsx\"                                     \n```\n:::\n:::\n\n\nPuse un punto **\".\"** porque para publicar esto r siempre me pone un directorio *default*, entonces el punto significa lo mismo que copiar este directorio. Y quiero que exploremos esta manera de utilizar directorios.\n\nAhora, podemos hacer varias cosas: dado que en la carpeta que descomprimimos viene un único archivo con todas las solicitudes de información, obviamente sería más fácil trabajar así. Pero, no aprenderíamos a trabajar con múltiples archivos al mismo tiempo. \n\nEntonces, vamos a utilizar las carpetas con los archivos individuales. De este modo, podríamos \"leer\" cada archivo de manera individual de la siguiente manera: \n\n\n::: {.cell}\n\n```{.r .cell-code}\narchivo1 <- read_excel(path = paste0(input, \"/2017/Delegación Álvaro Obregón-2017.xlsx\"))\nlist.files(paste(input, \"2017\", sep = \"/\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Delegación Álvaro Obregón-2017.xlsx\"                                                  \n [2] \"Delegación Azcapotzalco-2017.xlsx\"                                                    \n [3] \"Delegación Benito Juárez-2017.xlsx\"                                                   \n [4] \"Delegación Coyoacán-2017.xlsx\"                                                        \n [5] \"Delegación Cuajimalpa de Morelos-2017.xlsx\"                                           \n [6] \"Delegación Cuauhtémoc-2017.xlsx\"                                                      \n [7] \"Delegación Gustavo A. Madero-2017.xlsx\"                                               \n [8] \"Delegación Iztacalco-2017.xlsx\"                                                       \n [9] \"Delegación Iztapalapa-2017.xlsx\"                                                      \n[10] \"Delegación La Magdalena Contreras-2017.xlsx\"                                          \n[11] \"Delegación Miguel Hidalgo-2017.xlsx\"                                                  \n[12] \"Delegación Milpa Alta-2017.xlsx\"                                                      \n[13] \"Delegación Tláhuac-2017.xlsx\"                                                         \n[14] \"Delegación Tlalpan-2017.xlsx\"                                                         \n[15] \"Delegación Venustiano Carranza-2017.xlsx\"                                             \n[16] \"Delegación Xochimilco-2017.xlsx\"                                                      \n[17] \"Instituto de Vivienda del Distrito Federal-2017.xlsx\"                                 \n[18] \"Instituto Local de la Infraestructura Física Educativa del Distrito Federal-2017.xlsx\"\n[19] \"Instituto para la Seguridad de las Construcciones en el Distrito Federal-2017.xlsx\"   \n[20] \"Jefatura de Gobierno del Distrito Federal-2017.xlsx\"                                  \n[21] \"Secretaría de Desarrollo Urbano y Vivienda-2017.xlsx\"                                 \n[22] \"Secretaría de Educación-2017.xlsx\"                                                    \n[23] \"Secretaría de Obras y Servicios-2017.xlsx\"                                            \n```\n:::\n:::\n\n\nLo primero que podemos notar es que son 23 archivos para el año 2017… Entonces, cargar cada archivo, sabiendo que tienen la misma estructura, es poco eficiente, especialmente si pensamos que todavía nos faltan los datos de 2018 y 2019. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist.files(paste(input, \"2018\", sep = \"/\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Comisión para la Reconstrucción-2018.xlsx\"                                                                                           \n [2] \"Comisión para la Reconstrucción, Recuperación y Transformación de la Ciudad de México, en una CDMX cada vez más resiliente-2018.xlsx\"\n [3] \"Delegación Álvaro Obregón-2018.xlsx\"                                                                                                 \n [4] \"Delegación Azcapotzalco-2018.xlsx\"                                                                                                   \n [5] \"Delegación Benito Juárez-2018.xlsx\"                                                                                                  \n [6] \"Delegación Coyoacán-2018.xlsx\"                                                                                                       \n [7] \"Delegación Cuajimalpa de Morelos-2018.xlsx\"                                                                                          \n [8] \"Delegación Cuauhtémoc-2018.xlsx\"                                                                                                     \n [9] \"Delegación Gustavo A. Madero-2018.xlsx\"                                                                                              \n[10] \"Delegación Iztacalco-2018.xlsx\"                                                                                                      \n[11] \"Delegación Iztapalapa-2018.xlsx\"                                                                                                     \n[12] \"Delegación La Magdalena Contreras-2018.xlsx\"                                                                                         \n[13] \"Delegación Miguel Hidalgo-2018.xlsx\"                                                                                                 \n[14] \"Delegación Milpa Alta-2018.xlsx\"                                                                                                     \n[15] \"Delegación Tláhuac-2018.xlsx\"                                                                                                        \n[16] \"Delegación Tlalpan-2018.xlsx\"                                                                                                        \n[17] \"Delegación Venustiano Carranza-2018.xlsx\"                                                                                            \n[18] \"Delegación Xochimilco-2018.xlsx\"                                                                                                     \n[19] \"Instituto de Vivienda del Distrito Federal-2018.xlsx\"                                                                                \n[20] \"Instituto Local de la Infraestructura Física Educativa del Distrito Federal-2018.xlsx\"                                               \n[21] \"Instituto para la Seguridad de las Construcciones en el Distrito Federal-2018.xlsx\"                                                  \n[22] \"Jefatura de Gobierno del Distrito Federal-2018.xlsx\"                                                                                 \n[23] \"Secretaría de Desarrollo Urbano y Vivienda-2018.xlsx\"                                                                                \n[24] \"Secretaría de Educación-2018.xlsx\"                                                                                                   \n[25] \"Secretaría de Obras y Servicios-2018.xlsx\"                                                                                           \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlist.files(paste(input, \"2019\", sep = \"/\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Alcaldía Álvaro Obregón-2019.xlsx\"                                                                                                   \n [2] \"Alcaldía Azcapotzalco-2019.xlsx\"                                                                                                     \n [3] \"Alcaldía Benito Juárez-2019.xlsx\"                                                                                                    \n [4] \"Alcaldía Coyoacán-2019.xlsx\"                                                                                                         \n [5] \"Alcaldía Cuajimalpa de Morelos-2019.xlsx\"                                                                                            \n [6] \"Alcaldía Cuauhtémoc-2019.xlsx\"                                                                                                       \n [7] \"Alcaldía Gustavo A. Madero-2019.xlsx\"                                                                                                \n [8] \"Alcaldía Iztacalco-2019.xlsx\"                                                                                                        \n [9] \"Alcaldía Iztapalapa-2019.xlsx\"                                                                                                       \n[10] \"Alcaldía La Magdalena Contreras-2019.xlsx\"                                                                                           \n[11] \"Alcaldía Miguel Hidalgo-2019.xlsx\"                                                                                                   \n[12] \"Alcaldía Milpa Alta-2019.xlsx\"                                                                                                       \n[13] \"Alcaldía Tláhuac-2019.xlsx\"                                                                                                          \n[14] \"Alcaldía Tlalpan-2019.xlsx\"                                                                                                          \n[15] \"Alcaldía Venustiano Carranza-2019.xlsx\"                                                                                              \n[16] \"Alcaldía Xochimilco-2019.xlsx\"                                                                                                       \n[17] \"Comisión para la Reconstrucción-2019.xlsx\"                                                                                           \n[18] \"Comisión para la Reconstrucción, Recuperación y Transformación de la Ciudad de México, en una CDMX cada vez más resiliente-2019.xlsx\"\n[19] \"Instituto de Vivienda de la Ciudad de México-2019.xlsx\"                                                                              \n[20] \"Instituto Local de la Infraestructura Física Educativa de la Ciudad de México-2019.xlsx\"                                             \n[21] \"Instituto para la Seguridad de las Construcciones en la Ciudad de México-2019.xlsx\"                                                  \n[22] \"Jefatura de Gobierno de la Ciudad de México-2019.xlsx\"                                                                               \n[23] \"Secretaría de Administración y Finanzas-2019.xlsx\"                                                                                   \n[24] \"Secretaría de Desarrollo Urbano y Vivienda-2019.xlsx\"                                                                                \n[25] \"Secretaría de Educación, Ciencia, Tecnología e Innovación-2019.xlsx\"                                                                 \n[26] \"Secretaría de Gestión Integral de Riesgos y Protección Civil-2019.xlsx\"                                                              \n[27] \"Secretaría de Inclusión y Bienestar Social-2019.xlsx\"                                                                                \n[28] \"Secretaría de Obras y Servicios-2019.xlsx\"                                                                                           \n```\n:::\n:::\n\n\nParece intimidante, ¿no? Leer 74 archivos para empezar a trabajar... Pero para eso tenemos **purrr**.\n\n## purrr::map()\n\nEste paquete nos permite realizar tareas de *Functional programming* una palabra elegante para decir realizar tareas repetitivas de manera más rápida y eficiente. Pueden consultar la documentación [aquí](https://purrr.tidyverse.org/).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprimer <- list.files(paste(input, \"2017\", sep = \"/\"))\n\nprimer_e <- map(\n    primer,\n    ~ read_excel(path = paste(input, \"2017\", .x, sep = \"/\"))\n)\n# View(primer_e)\n```\n:::\n\n\nCon este código ya abrimos los 23 archivos de excel :D \n\nPero, aún no podemos usarlos como base de datos :( \n\nEsto se debe a que **map** es una función especial de purrr. Ya vimos lo que hace, pero no sabemos por qué. \n\n**map** nos permite aplicar una función a todos los elementos de una lista o vector que nosotros le proporcionemos. En este caso, utilicé *list.files* para crear un objeto llamado *primer*. \n\nLuego, le decimos que función queremos que aplique. Como queremos que learchivos en formato xlsx (*exceles*), le ponemos *read_excel*. Y aquí vamos a repasar todo. Esta función tiene un montón de parámetros para leer *exceles*. Pero por ahora nos importa uno: donde está el archivo **path = **. Aquí utilicé una función *paste* que sirve para pegar *strings* lo que nos permite abrir los archivos de Excel.\n\n* input, como mencioné, es la carpeta con todos los datos descomprimidos.\n* 2017 es la carpeta del año con los archivos individuales\n* **.x** es un argumento de la función *map* es el i-esímo objeto al que le aplicaremos la función. Como espero hayas notado, primer es el objeto con la lista de archivos excel dentro de la carpeta, por eso necesito el *paste* para que vaya cambiando. \nEn otras palabras, el .x es la variable que irá cambiando hasta que termine de leer los archivos. \n\nAhora lo que queremos es poder utilizar los datos como siempre, en un *data frame*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprimer_f <- bind_rows(primer_e)\n\ndim(primer_f)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2541   40\n```\n:::\n:::\n\n\nComo sabemos que todo tiene la misma estructura, podemos combinar los archivos por renglones. Estamos pegando un archivo debajo de otro, debajo de otro y así, siempre y cuando tengan los mismos encabezados. Esto último es fundamental porque **bind_rows** es un función de *dplyr* y si no tienen los mismos encabezados y dimensiones no podríamos hacerlo. No es como su \"primo\" **cbind** de r base, que solo necesita que tenga el mismo número de columnas y lo une como esté. A veces la utilizaremos, pero necesitamos estar seguras de cómo y cuándo.\n\nSólo falta hacer lo mismo para los otros años:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsegundo <- list.files(paste(input, \"2018\", sep = \"/\"))\n\nsegundo_e <- map(\n    segundo,\n    ~ read_excel(path = paste(input, \"2018\", .x, sep = \"/\"))\n)\n\nsegundo_f <- bind_rows(segundo_e)\n\ndim(segundo_f)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3241   40\n```\n:::\n\n```{.r .cell-code}\ntercer <- list.files(paste(input, \"2019\", sep = \"/\"))\n\ntercer_e <- map(\n    tercer,\n    ~ read_excel(path = paste(input, \"2019\", .x, sep = \"/\"))\n)\n\ntercer_f <- bind_rows(tercer_e)\n\ndim(tercer_f)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1717   40\n```\n:::\n:::\n\n\nEn el caso de 2018, les va a salir un error, y es que el nombre del primer archivo es exageradamente largo: \"Comisión para la Reconstrucción, Recuperación y Transformación de la Ciudad de México, en una CDMX cada vez más resiliente-2018.xlsx\" por eso hay que cambiarlo a mano en nuestra carpeta. A **map** no le importa los nombres de los archivos, pero sí la longitud de los *strings*. Si creen que el nombre es demasiado largo, tal vez tengan razón. Porque lo mismo pasa para el 2019: \"Comisión para la Reconstrucción, Recuperación y Transformación de la Ciudad de México, en una CDMX cada vez más resiliente-2019.xlsx\"\n\nY todas tienen 40 columnas, entonces, el siguiente paso es más fácil. Ahora tenemos 3 archivos, uno correspondiente a cada año. Pero, generalmente, es más fácil tener todo dentro de una sola base de datos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- bind_rows(primer_f, segundo_f, tercer_f)\n\ndim(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 7499   40\n```\n:::\n:::\n\n\n## Gráficas\n\nAhora tenemos una base de datos con 6,819 renglones y 40 columnas. Y con esto podemos ponernos a hacer algunas gráficas. \n\nPero, hay un pequeño, pequeñísimo problema... Los nombres de las columnas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"No.\"                                                                                                                  \n [2] \"Sujeto_N\"                                                                                                             \n [3] \"Sujeto\"                                                                                                               \n [4] \"Organo_N\"                                                                                                             \n [5] \"Clave\"                                                                                                                \n [6] \"Propio\"                                                                                                               \n [7] \"( A )\\r\\n\\r\\nFolio\"                                                                                                   \n [8] \"( B )\\r\\n\\r\\nFecha de presentación de la solicitud\\r\\n\\r\\ndd/mm/aaaa\"                                                 \n [9] \"( C )\\r\\n\\r\\nMedio por el que se presentó la solicitud\"                                                               \n[10] \"( D )\\r\\n\\r\\nInformación objeto de la solicitud \\r\\n\\r\\n(PROTEGER EN TODO MOMENTO LOS DATOS PERSONALES)\"              \n[11] \"( E )\\r\\n\\r\\nN° de preguntas que comprende la solicitud\"                                                              \n[12] \"( F )\\r\\n\\r\\nTemática de la información requerida\"                                                                    \n[13] \"( F_1 )\\r\\n\\r\\nÁrea de interés del Solictante\"                                                                        \n[14] \"( G )\\r\\n\\r\\nLa información solicitada fue de oficio\"                                                                 \n[15] \"( H )\\r\\n\\r\\nEstado en que se encontraba la solicitud\"                                                                \n[16] \"prevencion_solicitante\"                                                                                               \n[17] \"( I_1 )\\r\\n\\r\\nFecha en la que el solicitante atendió la prevención\"                                                  \n[18] \"( I_2 )\\r\\n\\r\\n¿La solicitud de información pública fue prevenida total o parcialmente?\"                              \n[19] \"( I_3 )\\r\\n\\r\\nNúmero de preguntas fueron prevenidas\"                                                                 \n[20] \"( J )\\r\\n\\r\\n¿Se notificó al solicitante ampliación de plazo para entregar la información?\"                           \n[21] \"( K )\\r\\n\\r\\nModalidad de repuesta\"                                                                                   \n[22] \"( L_1 ) \\r\\n\\r\\nTotal de Entes públicos a los que se turnó la solicitud\"                                              \n[23] \"( L_2 ) \\r\\n\\r\\nEnte Público al \\r\\nque se turnó la solicitud\"                                                        \n[24] \"( M )\\r\\n\\r\\n¿Se entregó o se envió por algún medio la información al solicitante?\"                                   \n[25] \"( N )\\r\\n\\r\\nPara la entrega de información, ¿se le requirió al solicitante algún monto por concepto de reproducción?\"\n[26] \"( O )\\r\\n\\r\\nMonto total requerido por concepto de reproducción\"                                                      \n[27] \"( P )\\r\\n\\r\\nMedio por el que se puso a disposición la información solicitada\"                                        \n[28] \"( Q )\\r\\n\\r\\nFecha en que se notificó la respuesta o se turnó la solicitud\\r\\n\\r\\ndd/mm/aaaa\"                         \n[29] \"( R )\\r\\n\\r\\nMedio por el que se notificó la respuesta\"                                                               \n[30] \"( S )\\r\\n\\r\\nDías HÁBILES  transcurridos entre la recepción de la solicitud y la notificación de respuesta\"           \n[31] \"( T )\\r\\n\\r\\nNo. de Servidores Públicos directamente involucrados en la respuesta de la solicitud\"                    \n[32] \"( U )\\r\\n\\r\\nSexo del solicitante\"                                                                                    \n[33] \"( V )\\r\\n\\r\\nEdad del solicitante\"                                                                                    \n[34] \"( W )\\r\\n\\r\\nOcupación del solicitante\"                                                                               \n[35] \"( X )\\r\\n\\r\\nEscolaridad del solicitante\"                                                                             \n[36] \"( Y )\\r\\n\\r\\nEstado de la República Mexicana o país que corresponde a la dirección que registró el solicitante\"       \n[37] \"( Z )\\r\\n\\r\\nObservaciones\"                                                                                           \n[38] \"mes\"                                                                                                                  \n[39] \"year\"                                                                                                                 \n[40] \"clasificacion\"                                                                                                        \n```\n:::\n:::\n\n\nAquí, sí se ven las diagonales inversas, si lo abren en excel verán que está en varios renglones, pero esto es muy difícil de trabajar en r. Para solucionar esto, vamos a cambiarle los nombres a todas las variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnombres <- c(\n    \"No.\",\n    \"Sujeto_N\",\n    \"Sujeto\",\n    \"Organo_N\",\n    \"clave\",\n    \"propio\",\n    \"Folio\",\n    \"fecha_presentacion\",\n    \"Medio_presento\",\n    \"Informacion_objeto\",\n    \"Preguntas_solicitud\",\n    \"Tematica_solicitud\",\n    \"Area_interes\",\n    \"info_de_oficio\",\n    \"Estado_info\",\n    \"prevencion_solicitante\",\n    \"fecha_prevencion\",\n    \"solicitud_prevenida\",\n    \"preguntas_prevenidas\",\n    \"notificar_ampliacion\",\n    \"modalidad_respuesta\",\n    \"total_entes_turnados\",\n    \"ente_turnado\",\n    \"info_entregada\",\n    \"costo_reproduccion\",\n    \"monto_reproduccion\",\n    \"medio_disposicion_info\",\n    \"fecha_notificacion\",\n    \"medio_notificacion\",\n    \"dias_transcurridos_recepcion_notificacion\",\n    \"Servidores_publicos_involucrados\",\n    \"sexo\",\n    \"edad\",\n    \"ocupacion\",\n    \"escolaridad\",\n    \"entidad_federativa\",\n    \"observaciones\",\n    \"mes\",\n    \"year\",\n    \"clasificacion\"\n)\n\nnames(data) <- nombres\n```\n:::\n\n\nPuse cada nombre en un reglón y un espacio cada 5 nombres, para no perderme, si se saben otra manera avísenme :P\n\nAdemás de cambiarle el nombre, vamos a utilizar la forma en que se procesan los datos: cambiar categorías, agrupar, crear nuevas variables, etc. Esto lo voy a hacer porque estoy familiarizado con este procesamiento. Creo que el código es autoexplicativo, pero si tienen alguna duda mandenme un DM en [twitter](https://twitter.com/dhumbertoj).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- data %>%\n    mutate(semana = week(fecha_presentacion)) %>%\n    group_by(year, Sujeto_N, semana) %>%\n    distinct(Informacion_objeto, .keep_all = T) %>%\n    ungroup() %>%\n    mutate(\n        clasificacion = str_replace_all(\n            clasificacion,\n            c(\n                \"daños\" = \"Daños\", \"evaluacion\" = \"Evaluación\",\n                \"fondos\" = \"Fondos\", \"legalidad\" = \"Legalidad\",\n                \"prevencion\" = \"Prevención\", \"reconstruccion\" = \"Reconstrucción\",\n                \"respuesta al sismo\" = \"Respuesta al sismo\"\n            )\n        ),\n        Tematica_solicitud = ifelse(str_detect(Tematica_solicitud, \"Otros\") == T,\n            \"Otros\",\n            ifelse(Tematica_solicitud == \"Datos Personales\",\n                \"Otros\", Tematica_solicitud\n            )\n        ),\n        modalidad_respuesta_2 = ifelse(str_detect(modalidad_respuesta, \"Aceptada\") == T,\n            \"Aceptada\",\n            ifelse(str_detect(modalidad_respuesta, \"restringido\") == T,\n                \"Acceso restringido\", modalidad_respuesta\n            )\n        ),\n        edad = as.numeric(edad),\n        grupo_edad = ifelse(edad <= 19, \"Hasta 19 años\",\n            ifelse(edad > 19 & edad < 30, \"De 20 a 29 años\",\n                ifelse(edad >= 30 & edad < 40, \"De 30 a 39 años\",\n                    ifelse(edad >= 40 & edad < 50, \"De 40 a 49 años\",\n                        ifelse(edad >= 50 & edad < 60, \"De 50 a 59 años\",\n                            ifelse(edad >= 60 & edad < 70, \"De 60 a 69 años\",\n                                ifelse(edad >= 70, \"70 o mas años\", edad)\n                            )\n                        )\n                    )\n                )\n            )\n        ),\n        grupo_edad = factor(grupo_edad, levels = c(\n            \"Hasta 19 años\", \"De 20 a 29 años\", \"De 30 a 39 años\",\n            \"De 40 a 49 años\", \"De 50 a 59 años\", \"De 60 a 69 años\",\n            \"70 o mas años\"\n        )),\n        escolaridad = str_replace_all(escolaridad, c(\n            \"Bachillerato o carrera técnica\" = \"Bachillerato\",\n            \"Bachillerato\" = \"Bachillerato o carrera técnica\",\n            \"Maestría o Doctorado\" = \"Maestría o doctorado\"\n        )),\n        ocupacion = str_replace_all(ocupacion, c(\n            \"Otros - Amas de Casa\" = \"Hogar\",\n            \"Otros - Organizaciones No Gubernamentales Internacionales\" = \"ONG\",\n            \"Otros - Organizaciones No Gubernamentales Nacionales\" = \"ONG\",\n            \"Otros - Asociación política\" = \"Asociación política\",\n            \"Servidor Público\" = \"Servicio público\",\n            \"Otros - Comerciante\" = \"Comercio\",\n            \"Otros - Empleado u obrero\" = \"Empleada/o u obrera/o\",\n            \"Empleado u obrero\" = \"Empleada/o u obrera/o\"\n        )),\n        ocupacion = ifelse(str_detect(ocupacion, \"Académico\") == T, \"Académico o estudiante\",\n            ifelse(str_detect(ocupacion, \"Empresarial\") == T, \"Empresa\",\n                ifelse(str_detect(ocupacion, \"Gubernamental\") == T, \"Servicio público\",\n                    ifelse(str_detect(ocupacion, \"omunicación\") == T, \"Medios de comunicación\",\n                        ifelse(str_detect(ocupacion, \"Otro\") == T, \"Otro\", ocupacion)\n                    )\n                )\n            )\n        ),\n        Organo_N = str_replace_all(Organo_N, c(\n            \"1\" = \"Administración Pública Central\",\n            \"2\" = \"Desconcentrados y Paraestales\",\n            \"3\" = \"Alcaldías\",\n            \"4\" = \"Judicial\",\n            \"5\" = \"Legislativo\",\n            \"6\" = \"Autónomo\",\n            \"7\" = \"Partidos Políticos\",\n            \"8\" = \"Sindicatos\"\n        )),\n        Preguntas_solicitud = as.numeric(Preguntas_solicitud),\n        preguntas_prevenidas = as.numeric(preguntas_prevenidas),\n        total_entes_turnados = as.numeric(total_entes_turnados),\n        info_entregada_2 = ifelse(str_detect(info_entregada, \"No\"), \"No\",\n            ifelse(str_detect(info_entregada, \"Si\"),\n                \"S?\", info_entregada\n            )\n        ),\n        dias_transcurridos_recepcion_notificacion =\n            as.numeric(dias_transcurridos_recepcion_notificacion),\n        Servidores_publicos_involucrados = as.numeric(Servidores_publicos_involucrados),\n        sexo = str_replace_all(sexo, c(\"Femenino\" = \"Mujeres\", \"Masculino\" = \"Hombres\"))\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `preguntas_prevenidas = as.numeric(preguntas_prevenidas)`.\nCaused by warning:\n! NAs introduced by coercion\n```\n:::\n\n```{.r .cell-code}\ndim(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 5168   44\n```\n:::\n:::\n\n\nLo que me gustaría enfatizar son las primeras 5 líneas de código. Yo revise esta base de datos y sé que hay muchas solicitudes repetidas. Pero, no puedo descartarlas solo por el hecho de estar repetidas. Quizás una persona estuvo realizando la misma solicitud sistemáticamente cada semana, o quizás a una persona se le fue el internet al terminar y realizó exactamente la misma solicitud. Por esa razón, y siguiendo los criterios del [Natalia Torres y Guillermo Cejudo](http://www.revistas.unam.mx/index.php/encrucijada/article/view/71485) para que solo se quede una solicitud con el mismo texto a la semana. Es decir, si es idéntico el texto de dos solicitudes con folio diferentes, y se presentó en la misma semana, solo se contará la más antigua.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolores <- c(\n    \"Daños\" = \"#ae3a3d\", \"Evaluación\" = \"#fc8d33\",\n    \"Fondos\" = \"#faef59\", \"Legalidad\" = \"#bcfa3d\",\n    \"Prevención\" = \"#4fc6c4\", \"Reconstrucción\" = \"#FF0066\",\n    \"Respuesta al sismo\" = \"#6600cc\"\n)\n```\n:::\n\n\nCódigos de colores para que todas las gráficas estén uniformes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n    group_by(year) %>%\n    mutate(tyear = n()) %>%\n    group_by(year, clasificacion, tyear) %>%\n    summarise(tclas = n()) %>%\n    ungroup() %>%\n    mutate(porc = tclas / tyear) %>%\n    ggplot(aes(x = year, y = porc, fill = clasificacion)) +\n    geom_bar(position = \"dodge\", stat = \"identity\") +\n    scale_y_continuous(labels = percent_format()) +\n    scale_fill_manual(values = colores) +\n    theme(legend.position = \"bottom\") +\n    theme_classic() +\n    labs(\n        title = \"Solicitudes por tema\",\n        subtitle = \"Dividido por año\",\n        x = \"\", y = \"\", fill = \"Clasificación\",\n        caption = \"Incluye personas que no proporcionaron información sociodemográfica.\\nTotal de observaciones = 5,168\"\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year', 'clasificacion'. You can override\nusing the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nAhora, aquí vemos que las solicitudes se concentran en un par de clasificaciones y R lo ajusta al tamaño de la pantalla. Pero acabo de leer un librito que les recomiendo mucho *How charts lie: Getting Smarter about Visual Information* sobre como entender mejor las gráficas y diseñarlas. En este sentido, quiero ver como se ve cuando el límite es 100%\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n    group_by(year) %>%\n    mutate(tyear = n()) %>%\n    group_by(year, clasificacion, tyear) %>%\n    summarise(tclas = n()) %>%\n    ungroup() %>%\n    mutate(porc = tclas / tyear) %>%\n    ggplot(aes(x = year, y = porc, fill = clasificacion)) +\n    geom_bar(position = \"dodge\", stat = \"identity\") +\n    ylim(0, 1) +\n    scale_fill_manual(values = colores) +\n    theme(legend.position = \"bottom\") +\n    theme_classic() +\n    labs(\n        title = \"Solicitudes por tema\",\n        subtitle = \"Dividido por año\",\n        x = \"\", y = \"\", fill = \"Clasificación\",\n        caption = \"Incluye personas que no proporcionaron información sociodemográfica.\\nTotal de observaciones = 5,168\"\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year', 'clasificacion'. You can override\nusing the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nAquí ya no pude poner el eje \"y\" como me hubiera gustado, pero la idea es muliplicar la leyenda por 100 para convertirlo en porcentaje.\n\nPodemos darnos cuenta de que poniendo como límite el 100 pierde todo el impacto la gráfica. Por lo que dejarla acotada hasta el 40% nos da una mejor visión para comparar entre categorías. Jugar con las gráficas siempre nos da perspectiva.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(data %>%\n    filter(!is.na(sexo)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3715\n```\n:::\n\n```{.r .cell-code}\nsummary(data %>%\n    filter(!is.na(sexo)) %>%\n    select(sexo) %>%\n    mutate(sexo = as.factor(sexo)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      sexo     \n Hombres:2637  \n Mujeres:1078  \n```\n:::\n\n```{.r .cell-code}\ndata %>%\n    filter(!is.na(sexo)) %>%\n    mutate(cont = 1) %>%\n    group_by(sexo, year) %>%\n    mutate(tsex = sum(cont, na.rm = T)) %>%\n    group_by(sexo, year, clasificacion, tsex) %>%\n    summarise(tclas = n()) %>%\n    ungroup() %>%\n    mutate(porc = tclas / tsex) %>%\n    ggplot(aes(x = sexo, y = porc, fill = clasificacion)) +\n    geom_bar(position = \"dodge\", stat = \"identity\") +\n    scale_fill_manual(values = colores) +\n    scale_y_continuous(labels = percent_format()) +\n    coord_flip() +\n    facet_grid(. ~ year) +\n    theme(legend.position = \"bottom\") +\n    theme_classic() +\n    labs(\n        title = \"Solicitudes por tema y sexo\",\n        subtitle = \"Dividido por año\",\n        x = \"\", y = \"\", fill = \"Clasificación\",\n        caption = \"Solo se consideran solicitudes con información sobre el sexo de la persona solicitante\\nTotal de observaciones = 3,715\"\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'sexo', 'year', 'clasificacion'. You can\noverride using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nAlgo que me parece fundamental es que solo el 71.9% de las solicitudes pusieron información sobre el sexo de la persona solicitante. Y de estas solicitudes, el 70.98% fueron realizadas por personas que se identifican como hombres.\n\nPor último, vamos a ver el comportamiento de las solicitudes por mes de los años en cuestión.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n    mutate(\n        mes = month(fecha_presentacion)\n    ) %>%\n    group_by(year, mes, clasificacion) %>%\n    summarise(total = n()) %>%\n    filter(year == 2017) %>%\n    ungroup() %>%\n    ggplot(aes(x = as.factor(mes), y = total, group = clasificacion)) +\n    geom_point(aes(color = clasificacion)) +\n    geom_line(aes(color = clasificacion)) +\n    scale_color_manual(\n        name = \"Clasificación\",\n        values = colores\n    ) +\n    scale_x_discrete(labels = c(\"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\")) +\n    labs(\n        title = \"Total de solicitudes por mes\",\n        subtitle = \"2017\",\n        x = \"\", y = \"\"\n    ) +\n    theme_classic() +\n    theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year', 'mes'. You can override using the\n`.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nDe esta gráfica lo más interesante es que en septiembre casi no hay solicitudes registradas, lo cual es bastante obvio porque estabaos en medio de una emergencia. Además, en todas estas gráficas utilizo números absolutos. El mes con más registros es octubre de 2017. En los años siguientes el pico nunca es tan alto.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n    mutate(\n        mes = month(fecha_presentacion)\n    ) %>%\n    group_by(year, mes, clasificacion) %>%\n    summarise(total = n()) %>%\n    filter(year == 2018) %>%\n    ungroup() %>%\n    ggplot(aes(x = as.factor(mes), y = total, group = clasificacion)) +\n    geom_point(aes(color = clasificacion)) +\n    geom_line(aes(color = clasificacion)) +\n    scale_color_manual(\n        name = \"Clasificación\",\n        values = colores\n    ) +\n    scale_x_discrete(labels = c(\n        \"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\",\n        \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"\n    )) +\n    labs(\n        title = \"Total de solicitudes por mes\",\n        subtitle = \"2018\",\n        x = \"\", y = \"\"\n    ) +\n    theme_classic() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 0.9),\n        legend.position = \"bottom\"\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year', 'mes'. You can override using the\n`.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n    mutate(\n        mes = month(fecha_presentacion)\n    ) %>%\n    group_by(year, mes, clasificacion) %>%\n    summarise(total = n()) %>%\n    filter(year == 2019) %>%\n    ungroup() %>%\n    ggplot(aes(x = as.factor(mes), y = total, group = clasificacion)) +\n    geom_point(aes(color = clasificacion)) +\n    geom_line(aes(color = clasificacion)) +\n    scale_color_manual(\n        name = \"Clasificación\",\n        values = colores\n    ) +\n    scale_x_discrete(labels = c(\n        \"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\",\n        \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"\n    )) +\n    labs(\n        title = \"Total de solicitudes por mes\",\n        subtitle = \"2019\",\n        x = \"\", y = \"\"\n    ) +\n    theme_classic() +\n    theme(\n        axis.text.x = element_text(angle = 45, hjust = 0.9),\n        legend.position = \"bottom\"\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'year', 'mes'. You can override using the\n`.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nCon estas gráficas podemos empezar a plantear preguntas más interesantes. Además, es un esfuerzo institucional. Al igual que todos los datos, necesitamos más contexto para poder realizar preguntas más interesantes. Hay más categorías en estas bases de datos, como ocupación, días hábiles en los que se dio respuesta, número de servidores públicos involucrados, etc. En lo que aprendo mejor *text mining* una primera aproximación es ver estas gráficas.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}