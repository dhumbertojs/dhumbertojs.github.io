{
  "hash": "493ce8a62b535da70474e19c3e9c52d6",
  "result": {
    "markdown": "---\ntitle: \"A un año de la Línea 12 con la API del INFO\"\ndescription: \"A un año del trágico accidente de la línea 12 del metro el equipo de Estado Abierto del INFO CDMX elaboró un reporte con información pública. En este post vamos a aprende a usar las API de datos abiertos (de CKAN) y analizar las solicitudes de información pública.\"\nauthor: \"David Humberto Jiménez S.\"\ndate: \"2022-09-13\"\ndate-modified: \"2023-11-30\"\ncategories: [code, visualization, politics, spanish]\n#image: \"sismo.png\"\n---\n\n\n# Solicitudes de ... qué?\n\nEl 4 de julio de 2022 se presentó un [informe](https://infocdmx.org.mx/images/biblioteca/2022/Reporte%20Metro%20L12%202022%20V4.pdf) de **Solicitudes de Información Pública** (SIP) sobre la Línea 12 del Metro en la Ciudad de México. En resumen, un tramo de la línea colapso por defectos en la construcción, las personas implicadas de su construcción están en puestos de gobierno y de toma de decisiones. Para sorpresa de nadie, los posibles implicados se están deslindando de responsabilidades y señalamientos.\n\n**Pero**, el informe se realizó con base en las SIP del 3 de mayo del 2021 al 11 de mayo de 2022, es decir: sobre lo que preguntan las personas a las instituciones de la Ciudad de México. Para ver la presentación pueden ver el siguiente [video](https://www.youtube.com/watch?v=isYuKVApYpg) y si quieren pueden leerlo [aquí](https://infocdmx.org.mx/images/biblioteca/2022/Reporte%20Metro%20L12%202022%20V4.pdf).\n\nY hasta ahí todo sin pena ni gloria: todo es trágico, la gente pide información y a se le deja esperando que alguien le responda. Clásico de una democracia, ¿verdad? Pues así era, hasta que \"alguien\" se enojó y regaño a dos comisionados del Instituto desde donde se realizó el informe. ¿Y la autonomía a'pá?\n\nSi no me creen, vean este [video](https://youtu.be/JtS3TBjBSLE?t=6672) donde en el pleno los comisionados, *cofcofmachitoscofcof*, continúan con la línea establecida por el gobierno, ofrecen *otros datos* (sello de esta era política): mayor número de solicitudes (porque evidentemente más preguntas significa más transparencia), y que más del **95%** han sido respondidas.\n\n¿Qué significa haber respondido una solicitud de transparencia? Más adelante hay un párrafo sobre algunos hallazgos sobre las respuestas de _esta_ base de datos. Además, si conocen de transparencia saben que una posible respuesta es que esa institución **no** tiene esa información. En aproximadamente la mitad de los casos no sabemos qué respondió el sujeto obligado.\n\nEn fin, este no es un rant, este es un blog de datos y eso es lo que haremos. Dado que ya se publicaron las SIP que se utilizaron en el informe, vamos a replicar las gráficas y ver que otra cosa sale.\n\n## Análisis\n\nEntonces, a mi me gusta llamar primero a las *libraries* que vamos a utilizar, luego los datos y empezar a explorar.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tm)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: NLP\n```\n:::\n\n```{.r .cell-code}\nlibrary(httr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'httr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:NLP':\n\n    content\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(plotly)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: ggplot2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'ggplot2'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:NLP':\n\n    annotate\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'plotly'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:ggplot2':\n\n    last_plot\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:httr':\n\n    config\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:stats':\n\n    filter\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:graphics':\n\n    layout\n```\n:::\n\n```{.r .cell-code}\nlibrary(xtable)\nlibrary(ggplot2)\nlibrary(stringr)\nlibrary(syuzhet)\nlibrary(jsonlite)\nlibrary(tidytext)\nlibrary(lubridate)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'lubridate'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n```\n:::\n:::\n\n\nAhora, podemos hacer lo de siempre y descargar los datos, importarlos y limpiarlos. Pero, como el punto de todo esto es aprender a hacer cosas nuevas vamos a leer la API de los datos abiertos del [INFO](https://datosabiertos.infocdmx.org.mx/dataset/linea-12-del-metro/resource/07fff148-a1bf-4fb7-9ed0-ed66b6907890).\n\n![Así debe verse](https://i.postimg.cc/HsqCBdMQ/2022-09-12.png)\n\nLe damos clic en explorar\n\n![Nueva pantalla...](https://i.postimg.cc/N0YFC1X7/2022-09-12-1.png)\n\nY en el botón verde que dice \"API de datos\" le damos clic y se verá de la siguiente manera:\n\n![Ta-dá!](https://i.postimg.cc/C15F9JxD/2022-09-12-2.png)\n\nSeleccionamos lo que está subrayado (así como queda en el código de abajo) que es el enlace que necesitamos para \"llamar\" a los datos. Para revisar por qué hice esto pueden checar el trabajo de [Alan Yeung](https://www.r-bloggers.com/2019/06/getting-open-data-into-r-from-ckan/)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://datosabiertos.infocdmx.org.mx/api/3/action/datastore_search?resource_id=07fff148-a1bf-4fb7-9ed0-ed66b6907890\"\nraw <- GET(url)\nstatus_code(raw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 200\n```\n:::\n:::\n\n\nDebe salir 200 para saber que se logró llamar a la información, si sale otra cosa vean el blog ya mencionado. Ambas funciones, *GET* y *status_code*, son del paquete *httr*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobs <- \"&limit=1807\"\nurl <- paste0(url, obs)\nlista <- fromJSON(url)\ndata <- lista$result$records\n```\n:::\n\n\nPor default la consulta tiene un límite de 100 observaciones, por eso a la *url* hay que agregarle el string *&limit=* donde el número es el total de observaciones que hay publicadas. Y del paquete *jsonlite* la función *fromJSON* nos permite obtener los datos (records). Y listo! Con estas instrucciones ya podemos utilizar todas los *datasets* que tiene publicados el INFO.\n\n## Análisis básico\n\nYa teniendo los datos listos, podemos hacer análisis adicionales a lo que se presenta en el [reporte](https://infocdmx.org.mx/images/biblioteca/2022/Reporte%20Metro%20L12%202022%20V4.pdf) (desde la página 17). Particularmente quiero explorar los textos y alguna cosa que se me vaya ocurriendo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"_id\"                         \"folio\"                      \n [3] \"fecha_de_ingreso\"            \"descripcion_de_la_solicitud\"\n [5] \"estatus\"                     \"medio_entrada\"              \n [7] \"tipo_solicitud\"              \"fecha_limite_de_respuesta\"  \n [9] \"respuesta\"                   \"dependencia\"                \n[11] \"organo_de_gobierno\"         \n```\n:::\n:::\n\n\n```{.r .cell-code}\ndata %>%\n    count(dependencia, sort = T) %>%\n    top_n(10) %>%\n    xtable() %>%\n    print(type = \"html\")\n```\n\n```\nSelecting by n\n```\n\n<!-- html table generated in R 4.2.2 by xtable 1.8-4 package -->\n<!-- Mon Dec  4 14:47:29 2023 -->\n<table border=1>\n<tr> <th>  </th> <th> dependencia </th> <th> n </th>  </tr>\n  <tr> <td align=\"right\"> 1 </td> <td> Sistema de Transporte Colectivo </td> <td align=\"right\"> 459 </td> </tr>\n  <tr> <td align=\"right\"> 2 </td> <td> Jefatura de Gobierno de la Ciudad de México </td> <td align=\"right\"> 398 </td> </tr>\n  <tr> <td align=\"right\"> 3 </td> <td> Secretaría de Obras y Servicios </td> <td align=\"right\"> 196 </td> </tr>\n  <tr> <td align=\"right\"> 4 </td> <td> Secretaría de Gestión Integral de Riesgos y Protección Civil </td> <td align=\"right\"> 142 </td> </tr>\n  <tr> <td align=\"right\"> 5 </td> <td> Fiscalía General de Justicia de la CDMX </td> <td align=\"right\">  66 </td> </tr>\n  <tr> <td align=\"right\"> 6 </td> <td> Secretaría de Movilidad </td> <td align=\"right\">  62 </td> </tr>\n  <tr> <td align=\"right\"> 7 </td> <td> Secretaría de la Contraloría General </td> <td align=\"right\">  56 </td> </tr>\n  <tr> <td align=\"right\"> 8 </td> <td> Secretaría de Gobierno </td> <td align=\"right\">  49 </td> </tr>\n  <tr> <td align=\"right\"> 9 </td> <td> Secretaría de Administración y Finanzas </td> <td align=\"right\">  37 </td> </tr>\n  <tr> <td align=\"right\"> 10 </td> <td> Comisión Ejecutiva de Atención a Víctimas de la Ciudad de México </td> <td align=\"right\">  35 </td> </tr>\n   </table>\n\n\n```{.r .cell-code}\ndata %>%\n    count(organo_de_gobierno, sort = T) %>%\n    xtable() %>%\n    print(type = \"html\")\n```\n\n<!-- html table generated in R 4.2.2 by xtable 1.8-4 package -->\n<!-- Mon Dec  4 14:47:29 2023 -->\n<table border=1>\n<tr> <th>  </th> <th> organo_de_gobierno </th> <th> n </th>  </tr>\n  <tr> <td align=\"right\"> 1 </td> <td> Administración Pública Central </td> <td align=\"right\"> 998 </td> </tr>\n  <tr> <td align=\"right\"> 2 </td> <td> Organismos desconcentrados, descentralizados, paraestatales y auxiliares </td> <td align=\"right\"> 563 </td> </tr>\n  <tr> <td align=\"right\"> 3 </td> <td> Órganos Autónomos </td> <td align=\"right\"> 109 </td> </tr>\n  <tr> <td align=\"right\"> 4 </td> <td> Poder Legislativo </td> <td align=\"right\">  47 </td> </tr>\n  <tr> <td align=\"right\"> 5 </td> <td> Sindicatos </td> <td align=\"right\">  41 </td> </tr>\n  <tr> <td align=\"right\"> 6 </td> <td> Alcaldías </td> <td align=\"right\">  36 </td> </tr>\n  <tr> <td align=\"right\"> 7 </td> <td> Partidos Políticos </td> <td align=\"right\">   6 </td> </tr>\n  <tr> <td align=\"right\"> 8 </td> <td> Poder Judicial </td> <td align=\"right\">   5 </td> </tr>\n  <tr> <td align=\"right\"> 9 </td> <td> Fideicomisos y fondos públicos </td> <td align=\"right\">   2 </td> </tr>\n   </table>\n\n\nEs evidente, que el Sistema de Transporte Colectivo (metro) iba a ser el sujeto obligado con más solicitudes de información pública sobre el tema.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data %>%\n#   count(respuesta)\n```\n:::\n\n\nDe las 1,807 solicitudes, hay 281 grupos de respuestas, y si empezamos a revisar vemos que los grupos se pueden reducir... No estaba en el plan, pero estaría interesante para revisar. Dado que se ve gigantesco, chéquenlo con calma en su equipo. Pero, a bote pronto, hay 600 solicitudes sin respuesta (**33%**), 444 (**25%**) se contestaron vía infomex (descanse en paz) o por la Plataforma Nacional de Transparencia (pero no sabemos que se respondió); 188 (**10%**) dijeron que la solicitud le corresponde a otro ente **OJO** este es el texto directo sin adornos abogadiles (nada contra ustedes; sin embargo, nadie entiende como escriben). 79 (**4%**) fueron prevenidas (esto significa que a las personas servidoras públicas no les quedó clara la, o las, preguntas y le piden más información a la persona solicitante) y 51 (**3%**) se declararon incompetentes para responder y 26 (**1%**) se reservaron, esto significa que es información que poseen las instituciones y que por motivos de seguridad no puede ser entregada por un tiempo determinado.\n\nDespués de todo ese rollo, falta 26% de las solicitudes... que están en *abogañol* o que no se puede clasificar en un ratito. Si quieren ayuda envíenme un [DM](https://twitter.com/dhumbertoj) Las cifras las fui sacando de medio leer los resultados en una hoja de Excel :P\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndias <- data %>%\n    mutate(dia = date(fecha_de_ingreso)) %>%\n    count(dia) %>%\n    ggplot(aes(x = dia, y = n)) +\n    geom_line() +\n    labs(\n        x = \"\", y = \"\",\n        title = \"Solicitudes por día\"\n    ) +\n    theme_classic()\nggplotly(dias)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-0c37a8d48d9971f79b3c\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-0c37a8d48d9971f79b3c\">{\"x\":{\"data\":[{\"x\":[18750,18751,18752,18753,18754,18755,18756,18757,18758,18759,18760,18761,18762,18763,18764,18765,18766,18767,18768,18769,18770,18771,18772,18773,18774,18775,18776,18777,18778,18780,18781,18782,18783,18785,18786,18787,18788,18789,18793,18794,18795,18796,18799,18801,18802,18803,18804,18805,18807,18808,18809,18810,18813,18814,18815,18816,18817,18820,18821,18822,18824,18827,18828,18829,18830,18834,18835,18841,18842,18844,18850,18851,18852,18853,18856,18857,18858,18859,18862,18863,18864,18865,18868,18869,18870,18871,18872,18873,18876,18877,18878,18879,18880,18882,18884,18885,18886,18887,18891,18893,18898,18900,18905,18906,18910,18913,18915,18919,18922,18924,18925,18926,18927,18933,18934,18940,18941,18943,18946,18947,18951,18952,18953,18955,18960,18961,18970,18972,18976,18981,18984,18988,19002,19003,19009,19011,19012,19013,19014,19019,19020,19023,19025,19026,19030,19031,19033,19034,19038,19039,19041,19045,19048,19050,19051,19052,19053,19054,19055,19056,19060,19064,19065,19066,19067,19068,19069,19073,19074,19075,19076,19077,19079,19080,19081,19082,19083,19086,19088,19089,19101,19102,19103,19107,19109,19110,19111,19114,19115,19116,19117,19118,19119,19120,19121,19122,19123],\"y\":[6,66,27,52,5,3,4,11,15,16,25,8,4,2,11,6,14,16,16,13,1,5,2,21,8,5,1,2,5,8,7,22,2,12,8,4,8,2,4,4,10,4,16,10,5,5,1,1,4,1,2,8,13,2,11,3,14,2,6,6,3,5,3,3,2,1,1,3,3,2,3,3,2,3,2,6,3,5,2,9,3,9,2,14,16,4,1,8,6,11,2,2,3,1,4,4,5,1,8,1,3,2,2,5,2,7,1,5,2,3,3,3,2,3,1,16,5,2,8,1,1,4,6,3,4,4,2,1,5,11,8,4,1,12,3,5,1,1,1,4,1,1,2,5,13,5,2,9,2,4,1,7,2,5,8,4,5,1,3,1,2,9,17,9,5,9,11,5,5,3,3,5,3,2,2,2,1,3,1,1,5,1,1,2,8,1,5,2,11,43,186,221,21,8,61,125,26],\"text\":[\"dia: 2021-05-03<br />n:   6\",\"dia: 2021-05-04<br />n:  66\",\"dia: 2021-05-05<br />n:  27\",\"dia: 2021-05-06<br />n:  52\",\"dia: 2021-05-07<br />n:   5\",\"dia: 2021-05-08<br />n:   3\",\"dia: 2021-05-09<br />n:   4\",\"dia: 2021-05-10<br />n:  11\",\"dia: 2021-05-11<br />n:  15\",\"dia: 2021-05-12<br />n:  16\",\"dia: 2021-05-13<br />n:  25\",\"dia: 2021-05-14<br />n:   8\",\"dia: 2021-05-15<br />n:   4\",\"dia: 2021-05-16<br />n:   2\",\"dia: 2021-05-17<br />n:  11\",\"dia: 2021-05-18<br />n:   6\",\"dia: 2021-05-19<br />n:  14\",\"dia: 2021-05-20<br />n:  16\",\"dia: 2021-05-21<br />n:  16\",\"dia: 2021-05-22<br />n:  13\",\"dia: 2021-05-23<br />n:   1\",\"dia: 2021-05-24<br />n:   5\",\"dia: 2021-05-25<br />n:   2\",\"dia: 2021-05-26<br />n:  21\",\"dia: 2021-05-27<br />n:   8\",\"dia: 2021-05-28<br />n:   5\",\"dia: 2021-05-29<br />n:   1\",\"dia: 2021-05-30<br />n:   2\",\"dia: 2021-05-31<br />n:   5\",\"dia: 2021-06-02<br />n:   8\",\"dia: 2021-06-03<br />n:   7\",\"dia: 2021-06-04<br />n:  22\",\"dia: 2021-06-05<br />n:   2\",\"dia: 2021-06-07<br />n:  12\",\"dia: 2021-06-08<br />n:   8\",\"dia: 2021-06-09<br />n:   4\",\"dia: 2021-06-10<br />n:   8\",\"dia: 2021-06-11<br />n:   2\",\"dia: 2021-06-15<br />n:   4\",\"dia: 2021-06-16<br />n:   4\",\"dia: 2021-06-17<br />n:  10\",\"dia: 2021-06-18<br />n:   4\",\"dia: 2021-06-21<br />n:  16\",\"dia: 2021-06-23<br />n:  10\",\"dia: 2021-06-24<br />n:   5\",\"dia: 2021-06-25<br />n:   5\",\"dia: 2021-06-26<br />n:   1\",\"dia: 2021-06-27<br />n:   1\",\"dia: 2021-06-29<br />n:   4\",\"dia: 2021-06-30<br />n:   1\",\"dia: 2021-07-01<br />n:   2\",\"dia: 2021-07-02<br />n:   8\",\"dia: 2021-07-05<br />n:  13\",\"dia: 2021-07-06<br />n:   2\",\"dia: 2021-07-07<br />n:  11\",\"dia: 2021-07-08<br />n:   3\",\"dia: 2021-07-09<br />n:  14\",\"dia: 2021-07-12<br />n:   2\",\"dia: 2021-07-13<br />n:   6\",\"dia: 2021-07-14<br />n:   6\",\"dia: 2021-07-16<br />n:   3\",\"dia: 2021-07-19<br />n:   5\",\"dia: 2021-07-20<br />n:   3\",\"dia: 2021-07-21<br />n:   3\",\"dia: 2021-07-22<br />n:   2\",\"dia: 2021-07-26<br />n:   1\",\"dia: 2021-07-27<br />n:   1\",\"dia: 2021-08-02<br />n:   3\",\"dia: 2021-08-03<br />n:   3\",\"dia: 2021-08-05<br />n:   2\",\"dia: 2021-08-11<br />n:   3\",\"dia: 2021-08-12<br />n:   3\",\"dia: 2021-08-13<br />n:   2\",\"dia: 2021-08-14<br />n:   3\",\"dia: 2021-08-17<br />n:   2\",\"dia: 2021-08-18<br />n:   6\",\"dia: 2021-08-19<br />n:   3\",\"dia: 2021-08-20<br />n:   5\",\"dia: 2021-08-23<br />n:   2\",\"dia: 2021-08-24<br />n:   9\",\"dia: 2021-08-25<br />n:   3\",\"dia: 2021-08-26<br />n:   9\",\"dia: 2021-08-29<br />n:   2\",\"dia: 2021-08-30<br />n:  14\",\"dia: 2021-08-31<br />n:  16\",\"dia: 2021-09-01<br />n:   4\",\"dia: 2021-09-02<br />n:   1\",\"dia: 2021-09-03<br />n:   8\",\"dia: 2021-09-06<br />n:   6\",\"dia: 2021-09-07<br />n:  11\",\"dia: 2021-09-08<br />n:   2\",\"dia: 2021-09-09<br />n:   2\",\"dia: 2021-09-10<br />n:   3\",\"dia: 2021-09-12<br />n:   1\",\"dia: 2021-09-14<br />n:   4\",\"dia: 2021-09-15<br />n:   4\",\"dia: 2021-09-16<br />n:   5\",\"dia: 2021-09-17<br />n:   1\",\"dia: 2021-09-21<br />n:   8\",\"dia: 2021-09-23<br />n:   1\",\"dia: 2021-09-28<br />n:   3\",\"dia: 2021-09-30<br />n:   2\",\"dia: 2021-10-05<br />n:   2\",\"dia: 2021-10-06<br />n:   5\",\"dia: 2021-10-10<br />n:   2\",\"dia: 2021-10-13<br />n:   7\",\"dia: 2021-10-15<br />n:   1\",\"dia: 2021-10-19<br />n:   5\",\"dia: 2021-10-22<br />n:   2\",\"dia: 2021-10-24<br />n:   3\",\"dia: 2021-10-25<br />n:   3\",\"dia: 2021-10-26<br />n:   3\",\"dia: 2021-10-27<br />n:   2\",\"dia: 2021-11-02<br />n:   3\",\"dia: 2021-11-03<br />n:   1\",\"dia: 2021-11-09<br />n:  16\",\"dia: 2021-11-10<br />n:   5\",\"dia: 2021-11-12<br />n:   2\",\"dia: 2021-11-15<br />n:   8\",\"dia: 2021-11-16<br />n:   1\",\"dia: 2021-11-20<br />n:   1\",\"dia: 2021-11-21<br />n:   4\",\"dia: 2021-11-22<br />n:   6\",\"dia: 2021-11-24<br />n:   3\",\"dia: 2021-11-29<br />n:   4\",\"dia: 2021-11-30<br />n:   4\",\"dia: 2021-12-09<br />n:   2\",\"dia: 2021-12-11<br />n:   1\",\"dia: 2021-12-15<br />n:   5\",\"dia: 2021-12-20<br />n:  11\",\"dia: 2021-12-23<br />n:   8\",\"dia: 2021-12-27<br />n:   4\",\"dia: 2022-01-10<br />n:   1\",\"dia: 2022-01-11<br />n:  12\",\"dia: 2022-01-17<br />n:   3\",\"dia: 2022-01-19<br />n:   5\",\"dia: 2022-01-20<br />n:   1\",\"dia: 2022-01-21<br />n:   1\",\"dia: 2022-01-22<br />n:   1\",\"dia: 2022-01-27<br />n:   4\",\"dia: 2022-01-28<br />n:   1\",\"dia: 2022-01-31<br />n:   1\",\"dia: 2022-02-02<br />n:   2\",\"dia: 2022-02-03<br />n:   5\",\"dia: 2022-02-07<br />n:  13\",\"dia: 2022-02-08<br />n:   5\",\"dia: 2022-02-10<br />n:   2\",\"dia: 2022-02-11<br />n:   9\",\"dia: 2022-02-15<br />n:   2\",\"dia: 2022-02-16<br />n:   4\",\"dia: 2022-02-18<br />n:   1\",\"dia: 2022-02-22<br />n:   7\",\"dia: 2022-02-25<br />n:   2\",\"dia: 2022-02-27<br />n:   5\",\"dia: 2022-02-28<br />n:   8\",\"dia: 2022-03-01<br />n:   4\",\"dia: 2022-03-02<br />n:   5\",\"dia: 2022-03-03<br />n:   1\",\"dia: 2022-03-04<br />n:   3\",\"dia: 2022-03-05<br />n:   1\",\"dia: 2022-03-09<br />n:   2\",\"dia: 2022-03-13<br />n:   9\",\"dia: 2022-03-14<br />n:  17\",\"dia: 2022-03-15<br />n:   9\",\"dia: 2022-03-16<br />n:   5\",\"dia: 2022-03-17<br />n:   9\",\"dia: 2022-03-18<br />n:  11\",\"dia: 2022-03-22<br />n:   5\",\"dia: 2022-03-23<br />n:   5\",\"dia: 2022-03-24<br />n:   3\",\"dia: 2022-03-25<br />n:   3\",\"dia: 2022-03-26<br />n:   5\",\"dia: 2022-03-28<br />n:   3\",\"dia: 2022-03-29<br />n:   2\",\"dia: 2022-03-30<br />n:   2\",\"dia: 2022-03-31<br />n:   2\",\"dia: 2022-04-01<br />n:   1\",\"dia: 2022-04-04<br />n:   3\",\"dia: 2022-04-06<br />n:   1\",\"dia: 2022-04-07<br />n:   1\",\"dia: 2022-04-19<br />n:   5\",\"dia: 2022-04-20<br />n:   1\",\"dia: 2022-04-21<br />n:   1\",\"dia: 2022-04-25<br />n:   2\",\"dia: 2022-04-27<br />n:   8\",\"dia: 2022-04-28<br />n:   1\",\"dia: 2022-04-29<br />n:   5\",\"dia: 2022-05-02<br />n:   2\",\"dia: 2022-05-03<br />n:  11\",\"dia: 2022-05-04<br />n:  43\",\"dia: 2022-05-05<br />n: 186\",\"dia: 2022-05-06<br />n: 221\",\"dia: 2022-05-07<br />n:  21\",\"dia: 2022-05-08<br />n:   8\",\"dia: 2022-05-09<br />n:  61\",\"dia: 2022-05-10<br />n: 125\",\"dia: 2022-05-11<br />n:  26\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":25.5707762557078,\"l\":28.4931506849315},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"Solicitudes por día\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[18731.35,19141.65],\"tickmode\":\"array\",\"ticktext\":[\"jul. 2021\",\"oct. 2021\",\"ene. 2022\",\"abr. 2022\"],\"tickvals\":[18809,18901,18993,19083],\"categoryorder\":\"array\",\"categoryarray\":[\"jul. 2021\",\"oct. 2021\",\"ene. 2022\",\"abr. 2022\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":true,\"linecolor\":\"rgba(0,0,0,1)\",\"linewidth\":0.66417600664176,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-10,232],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"50\",\"100\",\"150\",\"200\"],\"tickvals\":[0,50,100,150,200],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"50\",\"100\",\"150\",\"200\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":true,\"linecolor\":\"rgba(0,0,0,1)\",\"linewidth\":0.66417600664176,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.88976377952756,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"507449ed36c0\":{\"x\":{},\"y\":{},\"type\":\"scatter\"}},\"cur_data\":\"507449ed36c0\",\"visdat\":{\"507449ed36c0\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nEl pico de solicitudes está el 5 de junio de 2022. En blogs pasados, específicamente en el análisis de [\"Días sin ti\"](https://dhumbertojs.github.io/posts/2020-12-09-das-sin-ti-anlisis-de-texto/) utilicé gráficas interactivas, donde podías hacer zoom y te daba información básica de la observación, aquí utilizo la misma técnica.\n\n## Análisis de texto\n\nAlgo que no va a ser muy riguroso es el análisis de texto, por qué? Porque las solicitudes de información se caracterizan por ser texto libre y contener, en algunos casos, datos personales. Si bien este dataset tiene testados los datos personales, estos son reemplazados por asteriscos. Aun así, espero encontrar algo interesante.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntexto <- data %>%\n    select(descripcion_de_la_solicitud) %>%\n    unnest_tokens(palabra, descripcion_de_la_solicitud) %>%\n    mutate(palabra = str_replace_all(palabra, c(\"á\" = \"a\", \"é\" = \"e\", \"í\" = \"i\", \"ó\" = \"o\"))) %>%\n    filter(!palabra %in% stopwords(\"es\")) %>%\n    filter(!palabra %in% c(\"metro\", \"12\", \"sistema\", \"transporte\", \"colectivo\", \"ciudad\", \"mexico\", \"solicito\", \"3\", \"linea\", \"informacion\", \"cdmx\", \"2021\"))\n```\n:::\n\n\nEsto ya se la saben, limpieza de textos para tener solo palabras. Ahora, mientras redactaba esto, salieron palabras comunes que son demasiado obvias: metro, 12, línea, sistema, transporte, colectivo, etc. Por eso las filtro antes\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntexto %>%\n    count(palabra, sort = T) %>%\n    top_n(20)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSelecting by n\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n         palabra    n\n1        empresa 1174\n2           mayo 1067\n3            dnv  886\n4  mantenimiento  759\n5          copia  717\n6        informe  652\n7          tramo  610\n8   construccion  598\n9          fecha  569\n10      dictamen  543\n11       colapso  539\n12     accidente  508\n13      gobierno  493\n14      contrato  451\n15   expedientes  448\n16          obra  444\n17      respecto  432\n18      ocurrido  431\n19    documentos  417\n20        trenes  415\n```\n:::\n:::\n\n\nAhora, el análisis de sentimiento con Syuzhet, que es unir dos dataframes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntexto_nrc <- get_nrc_sentiment(char_v = texto$palabra, language = \"spanish\")\ntexto_fin <- bind_cols(texto, texto_nrc)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntexto_fin %>%\n    pivot_longer(\n        cols = 2:11\n    ) %>%\n    group_by(name) %>%\n    summarise(total = sum(value)) %>%\n    ungroup() %>%\n    mutate(name = reorder(name, total)) %>%\n    ggplot(aes(x = name, y = total, fill = name)) +\n    geom_bar(stat = \"identity\") +\n    scale_fill_manual(\n        breaks = c(\"disgust\", \"surprise\", \"anger\", \"joy\", \"anticipation\", \"fear\", \"sadness\", \"trust\", \"positive\", \"negative\"),\n        values = c(\"#24D204\", \"#06CBBE\", \"#CB0606\", \"#FBFE00\", \"#FF9200\", \"#46BF5F\", \"#5479C3\", \"#01FF4C\", \"#FF00DC\", \"#000000\")\n    ) +\n    theme_classic() +\n    labs(\n        title = \"Análisis de sentimientos\",\n        subtitle = \"Syuzhet\",\n        x = \"\", y = \"\"\n    ) +\n    theme(legend.position = \"blank\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nResalta que la mayoría de las palabras tienen un sentido negativo... Lo cual tiene cierta lógica, uno no pide información porque ande feliz. Por otro lado, también es sorprendente que no haya tantas palabras relacionadas con el enojo... Si quieren entender que está pasando detrás, vean la documentación de [Syuzhet](https://cran.r-project.org/web/packages/syuzhet/vignettes/syuzhet-vignette.html).\n\nSi a alguien se le ocurre algo más que se pueda hacer, hágamelo saber. Por ahora, creo que esto nos da en qué pensar. Si bien es limitado el número de variables en estas bases de datos, mientras más análisis se realicen con esta información se podrán aprovechar mejor. O bien, nos daremos cuenta de que información hace falta y se podría solicitar que se libere.\n\nMuchas gracias a [Zule](https://twitter.com/zuleeoviedo) por su lectura y recomendaciones para que este texto sea más entendible.",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\r\n<script src=\"../../site_libs/plotly-binding-4.10.3/plotly.js\"></script>\r\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\r\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\r\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\r\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}